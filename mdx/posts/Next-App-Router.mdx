---
title: Next.jsì˜ app routerë¥¼ ì•Œì•„ë³´ì.
description: Next.js 13ì˜ ì‹  ê¸°ëŠ¥ì¸ app routerë¥¼ ì•Œì•„ë³´ì.
date: 2023.09.19
tags: React, Front-end, Next
image: /thumbnail/Next.webp
---

> â— í•´ë‹¹ ë¬¸ì„œì˜ ì¼ë¶€ëŠ” RFCë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì“°ì—¬ì ¸ìˆì–´ì„œ, ì¶”í›„ì— ìŠ¤í™ì´ ë°”ë€” ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.  
> ğŸ’¡ RSCëŠ” React Server Components, RCCëŠ” React Client Components ì…ë‹ˆë‹¤.
> ğŸ’¡ ì•„ë˜ì˜ jsíŒŒì¼ë“¤ì€ ëª¨ë‘ (jsx | ts | tsx)ë¡œë„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

## App Router?

NEXT.JSì˜ ìƒˆë¡œìš´ ë¼ìš°íŒ… ê¸°ëŠ¥ì¸ app routerëŠ” 13 ë²„ì „ë¶€í„° betaë¡œ ì¶œì‹œë˜ì—ˆê³ , 13.4 ë²„ì „ë¶€í„° stableí•œ ìƒíƒœê°€ ë˜ì—ˆë‹¤.

app routerì˜ ìƒˆë¡œìš´ ê¸°ëŠ¥ê³¼ ì´ì „ page routerì™€ì˜ ì°¨ì´ì ì„ ì •ë¦¬í•´ë³¸ë‹¤.

## Why?

Next.jsë¥¼ í•„ë‘ë¡œ CSRì—ì„œ SSRë¡œ ëŒ€ì„¸ê°€ íë¥´ê³  ìˆë‹¤. ë¦¬ì•¡íŠ¸ëŠ” ê±°ê¸°ì— ë”í•´ React Server Componentsë¡œ SSRì„ ë”ìš± ì§€ì›í•˜ë ¤ëŠ” ì›€ì§ì„ì„ ë³´ì¸ë‹¤. NEXT.JSì˜ App routerëŠ” ë‹¬ë¼ì§„ í˜ì´ì§€ êµ¬ì„± + React Server Components ì‚¬ìš© + ìƒˆë¡œìš´ SSR ë°©ì‹ì„ í•©ì¹œ ë¼ìš°íŠ¸ êµ¬ì¡°ì´ë‹¤.

ë”°ë¼ì„œ App routerëŠ” ì´ì „ê³¼ ë¹„êµí•˜ì—¬ ì—¬ëŸ¬ ì´ì ì„ ê°€ì§€ê³  ìˆë‹¤.

## ë‹¬ë¼ì§„ í˜ì´ì§€ êµ¬ì„±

ì´ì „ë¶€í„° íŒŒì¼ ì‹œìŠ¤í…œ ê¸°ë°˜ ë¼ìš°íŒ…ì€ Next.jsì˜ í•µì‹¬ ê¸°ëŠ¥ì´ì—ˆë‹¤. ì´ëŠ” ê°œë°œìê°€ ì–´ë–¤ setup ì—†ì´ë„ ê°„ë‹¨í•˜ê²Œ ë¼ìš°íŠ¸ êµ¬ì¡°ë¥¼ ë§Œë“¤ê²Œ í•˜ê¸° ìœ„í•¨ì´ë‹¤. ([ì°¸ê³ ì‚¬í•­](https://nextjs.org/blog/next-13-4?utm_source=marketo&utm_medium=email&utm_campaign=monthly_newsletter&mkt_tok=MDAxLUxSRy0xOTQAAAGL6fUMIvj-Hv_SiYh-E66Wv6IynrHAkFo2f-rk25syE4jknhv1zTZ_9L1HSSbHF6ilPWzM9jOFZldGXlsWqzcvBrqClmJgI_CL0CF3hScz#zero-setup-use-the-filesystem-as-an-api))

í•˜ì§€ë§Œ ì‹œê°„ì´ ì§€ë‚˜ë©´ì„œ(ë‹¹ì—°í•˜ê²Œë„) ìƒˆë¡œìš´ ìš”êµ¬ë“¤ì´ ìƒê²¨ë‚¬ë‹¤.  
Layout, nesting, loading, error ë“±ì´ ê·¸ë ‡ë‹¤.  
í•´ë‹¹ ê¸°ëŠ¥ë“¤ì€ ì´ì „ì˜ ë¼ìš°íŠ¸ êµ¬ì¡°ë¡œëŠ” ê°œì¡°ê°€ í˜ë“¤ì—ˆê¸° ë•Œë¬¸ì— ì™„ì „íˆ ìƒˆë¡œìš´ app routerê°€ ë§Œë“¤ì–´ì¡Œë‹¤.

### Tree

![Next.js new layout tree](/image/Next-App-Router-Tree.png)

Tree êµ¬ì¡°ëŠ” ì´ì „ê³¼ ë¹„ìŠ·í•˜ë‹¤.

ë‹¤ë§Œ ìƒˆë¡œìš´ app routerì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ì°¨ì´ì ë“¤ì´ ì¡´ì¬í•œë‹¤.

### Page

`page.js`ê°€ ìƒˆë¡œìš´ íŒŒì¼ ì»¨ë²¤ì…˜ìœ¼ë¡œ ë“±ì¥í–ˆë‹¤.  
ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ë‹¹ í•˜ë‚˜ë§Œ ì¡´ì¬í•˜ëŠ” `page.js`ëŠ” í•´ë‹¹ ì„¸ê·¸ë¨¼íŠ¸ì˜ ëŒ€í‘œ(ì´ë¦„ ê·¸ëŒ€ë¡œ í˜ì´ì§€) ì»´í¬ë„ŒíŠ¸ë‹¤.

### Layout

`layout.js`ê°€ ìƒˆë¡œìš´ íŒŒì¼ ì»¨ë²¤ì…˜ìœ¼ë¡œ ë“±ì¥í–ˆë‹¤.  
`layout.js`ëŠ” í•´ë‹¹ ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ì™€ í•˜ìœ„ ì„¸ê·¸ë¨¼íŠ¸ê°€ ëª¨ë‘ ê³µìœ í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì´ë‹¤.

- pathë‚˜ ìì‹ ìš”ì†Œì˜ ë¦¬ë Œë”ë§ì´ ì¼ì–´ë‚˜ë„ layout ì»´í¬ë„ŒíŠ¸ëŠ” ë³„ê°œì´ë‹¤.
- ë°ì´í„° í˜ì¹­ ê°™ì€ ì—­í• ë„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
- ë¬´ì¡°ê±´ children ìš”ì†Œë¥¼ ë°›ì•„ì•¼í•œë‹¤.
- ì´ì „ì—ëŠ” `_app.js`ë¥¼ ì œì™¸í•œ ë‹¤ë¥¸ router ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” external npm packages stylesheetsë¥¼ importí•  ìˆ˜ ì—†ì—ˆë‹¤.  
  í•˜ì§€ë§Œ app routerì—ì„œëŠ” ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ custom stylesheetsë¥¼ importí•  ìˆ˜ ìˆë‹¤.
- Layoutì€ í•˜ìœ„ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ë”°ë¼ê°€ë©´ì„œ ì¤‘ì²©ë  ìˆ˜ ìˆë‹¤. (ê¸°ë³¸ì ìœ¼ë¡œ ì¤‘ì²©ëœë‹¤.)

![Next.js new layout nesting](/image/Next-App-Router-Nesting.png)

#### Root layout

App directory ê°€ì¥ ìƒìœ„ì— ìˆëŠ” layout.js ë¥¼ root layoutì´ë¼ í•œë‹¤.

- í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ëŠ” ëª¨ë“  ë¼ìš°íŠ¸ì—ì„œ ë™ì‘í•˜ë¯€ë¡œ, ì´ì „ ë²„ì „ì˜ `_app.js`ì™€ `_document.js`ë¥¼ ëŒ€ì²´í•œë‹¤.
- `<html>`, `<head>`, `<body>` ëª¨ë‘ ì»¤ìŠ¤í…€ í•  ìˆ˜ ìˆë‹¤.(ì„œë²„ ì‚¬ì´ë“œì—ì„œ ì»¤ìŠ¤í…€ì´ ëœë‹¤.)

## React Server Components

(ì•„ì§ ë§ì€ ì •ë³´ê°€ ë‚˜ì˜¤ì§€ ì•Šê³ , ê°œë… ì´í•´ê°€ ì¶©ë¶„í•˜ì§€ ì•Šì•„ì„œ ë¶€ì¡±í•œ ì •ë³´ë“¤ì…ë‹ˆë‹¤.)

- App router ì•ˆì˜ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ React Server Componentsë¥¼ ì‚¬ìš©í•œë‹¤.
- server component hooksë¼ëŠ” ê°œë…ì´ ì¶”ê°€ë  ê²ƒì´ë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ app routerëŠ” static generation ë°©ì‹ìœ¼ë¡œ ì‘ë™í•˜ê³ , **server-side hooksë¥¼ ì‚¬ìš©í•  ë•Œì—ë§Œ** dynamic rendering ìœ¼ë¡œ ë™ì‘í•œë‹¤.

### RSC VS RCC

![Difference with RSC and RCC](/image/Next-App-Router-Difference.png)

### With RCC

í”„ë¡œì íŠ¸ì˜ ì„±ëŠ¥ì„ ìœ„í•´ì„  client componentsë¥¼ ìµœí•˜ìœ„ íŠ¸ë¦¬(leaf tree)ì— ë°°ì¹˜í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ì´ë¥¼ í†µí•´ clientì˜ ì˜ì—­ì„ ìµœì†Œí™”í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

### Composing Client and Server Components

ì„œë²„ ë‹¨ì—ì„œ ëª¨ë“  RSCëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬ë˜ê¸° ì „ì— ë Œë”ë§ì´ ì¼ì–´ë‚œë‹¤.

- í•´ë‹¹ ì‘ì—…ì€ RCC ì•ˆì— ìˆëŠ” RSCë„ ë§ˆì°¬ê°€ì§€ì´ë‹¤.
- ì´ë•Œ RCCëŠ” ìŠ¤í‚µëœë‹¤.

í´ë¼ì´ì–¸íŠ¸ ë‹¨ì—ì„œëŠ” RCCê°€ ë Œë”ë§ë˜ê³  RSCì˜ soltsë¥¼ ë Œë”ë§ í•œë’¤ RSCì™€ RCCë¥¼ ë³‘í•©í•œë‹¤.

#### Nesting Server Components inside Client Components

RCC ì•ˆì— RSCë¥¼ nesting í•  ë•Œ, ì¼ë°˜ì ì¸ import ë°©ì‹ì€ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤.

ì•„ë˜ëŠ” ë™ì‘í•˜ì§€ ì•ŠëŠ” ì˜ˆì‹œì´ë‹¤.

```tsx
"use client";

// This pattern will **not** work!
// You cannot import a Server Component into a Client Component.
import ExampleServerComponent from "./example-server-component";

export default function ExampleClientComponent({ children }: { children: React.ReactNode }) {
  const [count, setCount] = useState(0);

  return (
    <>
      <button onClick={() => setCount(count + 1)}>{count}</button>

      <ExampleServerComponent />
    </>
  );
}
```

ëŒ€ì‹ ì—, RCC ì•ˆì— RSCë¥¼ nestingí•˜ê¸° ìœ„í•´ì„  RSCë¥¼ propsë¡œ ë°›ì•„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

ì•„ë˜ëŠ” RSCë¥¼ childrenìœ¼ë¡œ ë°›ì•„ ë™ì‘í•˜ëŠ” ì˜ˆì‹œì´ë‹¤.

ë‹¹ì—°íˆ childrenì´ ì•„ë‹Œ ë‹¤ë¥¸ propsë¡œ RSCë¥¼ ë°›ì•„ë„ ë™ì‘í•œë‹¤.

ì´ëŠ” propsë¡œ ë°›ì€ ì»´í¬ë„ŒíŠ¸ê°€ ë…ë¦½ì ìœ¼ë¡œ ë Œë”ë§ë˜ê¸° ë•Œë¬¸ì´ë‹¤.

```tsx
"use client";

import { useState } from "react";

export default function ExampleClientComponent({ children }: { children: React.ReactNode }) {
  const [count, setCount] = useState(0);

  return (
    <>
      <button onClick={() => setCount(count + 1)}>{count}</button>

      {children}
    </>
  );
}
```

#### Passing props from Server to Clien Componenets (Serialization)

RSCì™€ RCCëŠ” ì½”ë“œê°€ ì•„ë‹ˆë¼ networkë¡œ í†µì‹ í•´ì•¼ í•œë‹¤.

ë¬¸ì„œì—ì„  ì´ë¥¼ `the network boundary is between Server Components and Client Components.`ë¼ê³  ì„¤ëª…í•˜ê³  ìˆë‹¤.

ë”°ë¼ì„œ RSCê³¼ RCCì˜ propsëŠ” networkë¥¼ í†µí•´ ì†Œí†µì„ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ë„¤íŠ¸ì›Œí¬ëŠ” JSì˜ functionì´ë‚˜ date ê°™ì€ íŠ¹ìˆ˜í•œ ë°ì´í„°ë¥¼ ìˆëŠ” ê·¸ëŒ€ë¡œ ë°›ì•„ë“¤ì´ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì— í•´ë‹¹ ì •ë³´ë“¤ì€ JSON.stringfy(), toString() ë“±ì˜ ë°©ë²•ìœ¼ë¡œ Serializationí•˜ì—¬ propsë¡œ ë„˜ê²¨ì¤˜ì•¼ë§Œ í•œë‹¤.

ì•„ë˜ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì—ëŸ¬ê°€ ë‚˜ì˜¨ë‹¤.

```tsx
import ExampleClientComponent from "./example-client-component";

export default function ExampleServerComponent({ children }: { children: React.ReactNode }) {
  return (
    <>
      <button onClick={() => setCount(count + 1)}>{count}</button>

      <ExampleClientComponent test={() => console.log("test")} />
    </>
  );
}
```

![Next.js error example](/image/Next-App-Router-Error.png)

ì´ë¥¼ í”¼í•˜ê¸° ìœ„í•´ì„  ì•„ë˜ì™€ ê°™ì´ propsë¥¼ ë„˜ê²¨ì¤€ ë’¤ ë°›ì€ propsë¥¼ eval() ë“±ìœ¼ë¡œ ì‚¬ìš©í•´ì£¼ì–´ì•¼ í•œë‹¤.

> â— ì°¸ê³ ë¡œ eval codeëŠ” mdnì— ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ë¼ê³  ì í˜€ìˆë‹¤! [[ì½ì–´ë³´ê¸°](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval)]

```tsx
import ExampleClientComponent from "./example-client-component";

export default function ExampleServerComponent({ children }: { children: React.ReactNode }) {
  const testFunc = () => console.log("test");

  return (
    <>
      <button onClick={() => setCount(count + 1)}>{count}</button>

      <ExampleClientComponent test={testFunc.toString()} />
    </>
  );
}
```

## ë‹¬ë¼ì§„ SSR

ì´ì „ getServerSidePropsë¥¼ í†µí•œ SSRì—ì„œëŠ” ì „ì²´ í˜ì´ì§€ê°€ hydrate ë˜ê¸° ì „ì— applicationì´ blockë˜ì—ˆë‹¤.  
í•˜ì§€ë§Œ App routerì—ì„œëŠ” [React Suspense](https://react.dev/reference/react/Suspense)ì™€ì˜ í†µí•©ì„ ì§„í–‰í–ˆê³ , ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì˜ blockì„ ì¼ìœ¼í‚¤ì§€ ì•Šê³  íŠ¹ì • ì»´í¬ë„ŒíŠ¸ë§Œ hydrateë¥¼ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤. (êµ¬ë™ ì›ë¦¬ë¥¼ ëª°ë¼ì„œ ë‹¨ìˆœ í•´ì„ì„.)

### Code splitting

ì´ì „ì—ëŠ” component-levelì—ì„œ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…ì„ í•˜ê¸° ìœ„í•´ next/dynamic ì„ ì‚¬ìš©í•´ì•¼ í–ˆë‹¤. (page ë‹¨ìœ„ì˜ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…ì€ ì´ì „ë¶€í„° ì§€ì›ë˜ì—ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ page Routerë¡œ ë‚˜ë‰œ í˜ì´ì§€ëŠ” ëª¨ë‘ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…ì´ ë˜ì–´ ìˆëŠ” ìƒíƒœì´ë‹¤.)  
í•˜ì§€ë§Œ App routerì—ì„œëŠ” client componentsë¥¼ ìë™ì ìœ¼ë¡œ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…í•´ì¤€ë‹¤.  
ë”°ë¼ì„œ ë‹¨ìˆœ ë¡œì§ë§Œìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ì˜ ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…ì´ ê°€ëŠ¥í•˜ë‹¤.

ì•„ë˜ì™€ ê°™ì€ ì˜ˆì‹œì—ì„œ ë¡œê·¸ì¸ í•˜ì§€ì•Šì€ ìœ ì €ëŠ” `<Dashboad />` ë¥¼ ë¡œë“œí•˜ì§€ ì•ŠëŠ”ë‹¤.

```tsx
// app/layout.tsx

import { getUser } from "./auth";
import { Dashboard, Landing } from "./components";

export default async function Layout() {
  const isLoggedIn = await getUser();
  return isLoggedIn ? <Dashboard /> : <Landing />;
}
```

## ETC

### use client

ê¸°ë³¸ì ìœ¼ë¡œ app routerë‚´ ì»´í¬ë„ŒíŠ¸ëŠ” ëª¨ë‘ react server componentsì´ê¸° ë•Œë¬¸ì—, useState, useEffect, window API ë“±ì„ ì‚¬ìš©í•˜ì§€ ëª»í•œë‹¤.  
í•´ë‹¹ ê¸°ëŠ¥ë“±ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  client componentsë¥¼ ì‚¬ìš©í•´ì£¼ì–´ì•¼ í•œë‹¤.  
client componentsë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ â€˜use clientâ€™ë¥¼ ì„ ì–¸í•´ì£¼ì–´ì•¼í•œë‹¤.  
ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```tsx
"use client";

import { useState } from "react";

export default function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

## ì¶œì²˜

- [https://nextjs.org/blog/next-13-4](https://nextjs.org/blog/next-13-4)
- [https://nextjs.org/blog/layouts-rfc](https://nextjs.org/blog/layouts-rfc)
- [https://react.dev/reference/react/Suspense](https://react.dev/reference/react/Suspense)
- [https://nextjs.org/docs/getting-started/react-essentials](https://nextjs.org/docs/getting-started/react-essentials)
